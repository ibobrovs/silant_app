<h2>Список машин</h2>

{% if user.is_authenticated and user.groups.first.name == 'Менеджер' %}
  <p><a href="{% url 'add_machine' %}">Добавить машину</a></p>
{% endif %}


<form method="get">
  <label>Модель техники:</label>
  <select name="model">
    <option value="">-- все --</option>
    {% for item in models %}
      <option value="{{ item.id }}" {% if selected.model == item.id|stringformat:"s" %}selected{% endif %}>{{ item.name }}</option>
    {% endfor %}
  </select>

  <label>Двигатель:</label>
  <select name="engine">
    <option value="">-- все --</option>
    {% for item in engines %}
      <option value="{{ item.id }}" {% if selected.engine == item.id|stringformat:"s" %}selected{% endif %}>{{ item.name }}</option>
    {% endfor %}
  </select>

  <label>Трансмиссия:</label>
  <select name="transmission">
    <option value="">-- все --</option>
    {% for item in transmissions %}
      <option value="{{ item.id }}" {% if selected.transmission == item.id|stringformat:"s" %}selected{% endif %}>{{ item.name }}</option>
    {% endfor %}
  </select>

  <label>Ведущий мост:</label>
  <select name="drive_axle">
    <option value="">-- все --</option>
    {% for item in drive_axles %}
      <option value="{{ item.id }}" {% if selected.drive_axle == item.id|stringformat:"s" %}selected{% endif %}>{{ item.name }}</option>
    {% endfor %}
  </select>

  <label>Управляемый мост:</label>
  <select name="steered_axle">
    <option value="">-- все --</option>
    {% for item in steered_axles %}
      <option value="{{ item.id }}" {% if selected.steered_axle == item.id|stringformat:"s" %}selected{% endif %}>{{ item.name }}</option>
    {% endfor %}
  </select>

  <button type="submit">Фильтр</button>
</form>

<table border="1">
  <thead>
    <tr>
      <th>Модель</th>
      <th>Зав. номер</th>
      <th>Дата отгрузки</th>
    </tr>
  </thead>
  <tbody>
    {% for machine in machines %}
      <tr onclick="window.location.href='{% url "machine_detail" machine.pk %}'" style="cursor: pointer;">
        <td>{{ machine.model }}</td>
        <td>{{ machine.serial_number }}</td>
        <td>{{ machine.shipment_date }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
